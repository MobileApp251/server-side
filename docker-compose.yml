version: '3.8'

services:
  # 1. Spring Boot Service
  spring-service:
    build: 
      context: ./clonejira
      dockerfile: Dockerfile
    container_name: spring_container
    restart: unless-stopped
    ports:
      - "8081:8080" # Map ra port 8081 để test riêng nếu cần (localhost:8081)
    networks:
      - app-network
    environment:
      - SERVER_PORT=8080

  # 2. PHP Service
  php-service:
    build: 
      context: ./calendar-sync-module
      dockerfile: Dockerfile
    container_name: php_container
    restart: unless-stopped
    ports:
      - "8082:80" # Map ra port 8082 để test riêng nếu cần (localhost:8082)
    networks:
      - app-network
    volumes:
      # Quan trọng: Mount code từ máy thật vào container để Hot Reload
      # Khi bạn sửa code PHP, nó cập nhật ngay lập tức không cần build lại
      - ./calendar-sync-module:/var/www/html

  # 3. Nginx Gateway
  gateway:
    build: 
      context: ./gateway
      dockerfile: Dockerfile
    container_name: gateway_container
    ports:
      - "80:80" # Đây là cổng chính bạn sẽ truy cập (localhost)
    networks:
      - app-network
    depends_on:
      - spring-service
      - php-service

networks:
  app-network:
    driver: bridge