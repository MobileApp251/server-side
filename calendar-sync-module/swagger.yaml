openapi: 3.0.3
info:
  title: Calendar Sync Module API
  description: |
    REST API documentation for Calendar Sync Module - A comprehensive task and calendar management system with notifications and issue tracking.
    
    ## Features
    - Calendar event management
    - Task tracking and filtering
    - Issue management for tasks
    - User notifications
    - Task statistics and analytics
    - Project-based task organization
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080
    description: Local development server (PHP built-in server)
  - url: http://localhost/calendar-sync-module
    description: Local Apache/Nginx server
  - url: https://api.example.com/calendar-sync-module
    description: Production server

tags:
  - name: Calendar
    description: Calendar view and date range queries
  - name: Events
    description: Event management with advanced filtering
  - name: Tasks
    description: Task retrieval by user and project
  - name: Issues
    description: Task issue tracking and management
  - name: Notifications
    description: User notification system
  - name: Statistics
    description: Analytics and statistics

paths:
  /api/calendar.php:
    get:
      tags:
        - Calendar
      summary: Get events by date range
      description: Retrieve calendar events within a specific date range for calendar view
      operationId: getEventsByDateRange
      parameters:
        - name: start_date
          in: query
          required: true
          description: Start date in YYYY-MM-DD format
          schema:
            type: string
            format: date
            example: "2025-01-01"
        - name: end_date
          in: query
          required: true
          description: End date in YYYY-MM-DD format
          schema:
            type: string
            format: date
            example: "2025-01-31"
        - name: proj_id
          in: query
          required: false
          description: Filter by project UUID
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  value:
                    success: true
                    data:
                      - id: 1
                        task_id: 123
                        proj_id: "550e8400-e29b-41d4-a716-446655440000"
                        title: "Complete project documentation"
                        description: "Write comprehensive API documentation"
                        start_date: "2025-01-15T09:00:00Z"
                        end_date: "2025-01-15T17:00:00Z"
                        status: "in_progress"
                        priority: "high"
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/events.php:
    get:
      tags:
        - Events
      summary: Get calendar events with filters
      description: Retrieve events with advanced filtering by status, priority, date range, and project
      operationId: getFilteredEvents
      parameters:
        - name: status
          in: query
          required: false
          description: Filter by status (comma-separated for multiple)
          schema:
            type: string
            example: "done,in_progress"
          explode: false
        - name: start_date
          in: query
          required: false
          description: Start date filter
          schema:
            type: string
            format: date
            example: "2025-01-01"
        - name: end_date
          in: query
          required: false
          description: End date filter
          schema:
            type: string
            format: date
            example: "2025-12-31"
        - name: proj_id
          in: query
          required: false
          description: Filter by project UUID
          schema:
            type: string
            format: uuid
        - name: priority
          in: query
          required: false
          description: Filter by priority (comma-separated for multiple)
          schema:
            type: string
            example: "high,medium"
          explode: false
      responses:
        '200':
          description: Successful response with filtered events
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  value:
                    success: true
                    data:
                      - id: 1
                        task_id: 123
                        title: "Task Title"
                        status: "in_progress"
                        priority: "high"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/user-tasks.php:
    get:
      tags:
        - Tasks
      summary: Get tasks by user
      description: Retrieve all tasks assigned to a specific user
      operationId: getUserTasks
      parameters:
        - name: uid
          in: query
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
            example: "660e8400-e29b-41d4-a716-446655440000"
        - name: proj_id
          in: query
          required: false
          description: Filter by project UUID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          uid:
                            type: string
                            format: uuid
                          total:
                            type: integer
                          tasks:
                            type: array
                            items:
                              $ref: '#/components/schemas/CalendarEvent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/project-tasks.php:
    get:
      tags:
        - Tasks
      summary: Get tasks by project
      description: Retrieve all tasks for a specific project
      operationId: getProjectTasks
      parameters:
        - name: proj_id
          in: query
          required: true
          description: Project UUID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          proj_id:
                            type: string
                            format: uuid
                          total:
                            type: integer
                          tasks:
                            type: array
                            items:
                              $ref: '#/components/schemas/CalendarEvent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/upcoming.php:
    get:
      tags:
        - Tasks
      summary: Get upcoming tasks
      description: Retrieve tasks that are due in the upcoming days
      operationId: getUpcomingTasks
      parameters:
        - name: days
          in: query
          required: false
          description: Number of days to look ahead (default 7)
          schema:
            type: integer
            default: 7
            minimum: 1
            maximum: 365
            example: 14
        - name: uid
          in: query
          required: false
          description: Filter by user UUID
          schema:
            type: string
            format: uuid
        - name: proj_id
          in: query
          required: false
          description: Filter by project UUID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response with upcoming tasks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/overdue.php:
    get:
      tags:
        - Tasks
      summary: Get overdue tasks
      description: Retrieve tasks that have passed their due date
      operationId: getOverdueTasks
      parameters:
        - name: uid
          in: query
          required: false
          description: Filter by user UUID
          schema:
            type: string
            format: uuid
        - name: proj_id
          in: query
          required: false
          description: Filter by project UUID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response with overdue tasks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/issues.php:
    get:
      tags:
        - Issues
      summary: Get issues for a task
      description: Retrieve all issues associated with a specific task
      operationId: getTaskIssues
      parameters:
        - name: task_id
          in: query
          required: true
          description: Task ID
          schema:
            type: integer
            example: 123
        - name: proj_id
          in: query
          required: true
          description: Project UUID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response with task issues
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  value:
                    success: true
                    data:
                      - id: 1
                        task_id: 123
                        proj_id: "550e8400-e29b-41d4-a716-446655440000"
                        issue_title: "Bug in authentication"
                        issue_description: "Users cannot login with special characters"
                        severity: "high"
                        status: "open"
                        created_at: "2025-01-15T10:30:00Z"
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Issues
      summary: Create a new issue
      description: Create a new issue for a task
      operationId: createIssue
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - task_id
                - proj_id
                - issue_title
              properties:
                task_id:
                  type: integer
                  example: 123
                proj_id:
                  type: string
                  format: uuid
                issue_title:
                  type: string
                  example: "Bug in authentication"
                issue_description:
                  type: string
                  example: "Detailed description of the issue"
                severity:
                  type: string
                  enum: [low, medium, high, critical]
                  example: "high"
                status:
                  type: string
                  enum: [open, in_progress, resolved, closed]
                  default: "open"
      responses:
        '201':
          description: Issue created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 1
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Issues
      summary: Update an issue
      description: Update an existing issue
      operationId: updateIssue
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: integer
                  example: 1
                issue_title:
                  type: string
                issue_description:
                  type: string
                severity:
                  type: string
                  enum: [low, medium, high, critical]
                status:
                  type: string
                  enum: [open, in_progress, resolved, closed]
      responses:
        '200':
          description: Issue updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "Issue updated successfully"
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Issues
      summary: Delete an issue
      description: Delete an existing issue
      operationId: deleteIssue
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: integer
                  example: 1
      responses:
        '200':
          description: Issue deleted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "Issue deleted successfully"
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/notifications.php:
    get:
      tags:
        - Notifications
      summary: Get user notifications
      description: Retrieve notifications for a specific user
      operationId: getUserNotifications
      parameters:
        - name: uid
          in: query
          required: true
          description: User UUID
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          required: false
          description: Maximum number of notifications to return
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 200
        - name: unread_only
          in: query
          required: false
          description: Return only unread notifications
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Successful response with notifications
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          notifications:
                            type: array
                            items:
                              $ref: '#/components/schemas/Notification'
                          unread_count:
                            type: integer
                            example: 5
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Notifications
      summary: Create a notification
      description: Create a new notification for a user
      operationId: createNotification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - uid
                - task_id
                - notification_type
              properties:
                uid:
                  type: string
                  format: uuid
                  example: "660e8400-e29b-41d4-a716-446655440000"
                task_id:
                  type: integer
                  example: 123
                notification_type:
                  type: string
                  enum: [task_assigned, task_due_soon, task_overdue, issue_created, comment_added]
                  example: "task_due_soon"
                message:
                  type: string
                  example: "Your task is due in 2 days"
      responses:
        '201':
          description: Notification created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 1
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Notifications
      summary: Mark notification(s) as read
      description: Mark a single notification or all notifications as read
      operationId: markNotificationAsRead
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  required:
                    - notification_id
                  properties:
                    notification_id:
                      type: integer
                      example: 1
                - type: object
                  required:
                    - uid
                  properties:
                    uid:
                      type: string
                      format: uuid
                      example: "660e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: Notification(s) marked as read successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "Notification marked as read"
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/statistics.php:
    get:
      tags:
        - Statistics
      summary: Get statistics
      description: Get comprehensive statistics for events and issues
      operationId: getStatistics
      parameters:
        - name: proj_id
          in: query
          required: false
          description: Filter statistics by project UUID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Successful response with statistics
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          events:
                            type: object
                            properties:
                              total:
                                type: integer
                                example: 150
                              by_status:
                                type: object
                                properties:
                                  done:
                                    type: integer
                                    example: 80
                                  in_progress:
                                    type: integer
                                    example: 50
                                  due:
                                    type: integer
                                    example: 15
                                  upcoming:
                                    type: integer
                                    example: 5
                              by_priority:
                                type: object
                                properties:
                                  high:
                                    type: integer
                                    example: 30
                                  medium:
                                    type: integer
                                    example: 70
                                  low:
                                    type: integer
                                    example: 50
                          issues:
                            type: object
                            properties:
                              total:
                                type: integer
                                example: 25
                              by_severity:
                                type: object
                                properties:
                                  critical:
                                    type: integer
                                    example: 2
                                  high:
                                    type: integer
                                    example: 8
                                  medium:
                                    type: integer
                                    example: 10
                                  low:
                                    type: integer
                                    example: 5
                              by_status:
                                type: object
                                properties:
                                  open:
                                    type: integer
                                    example: 10
                                  in_progress:
                                    type: integer
                                    example: 8
                                  resolved:
                                    type: integer
                                    example: 5
                                  closed:
                                    type: integer
                                    example: 2
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  schemas:
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          description: Response data (structure varies by endpoint)

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Error message"
        code:
          type: integer
          example: 400

    CalendarEvent:
      type: object
      properties:
        id:
          type: integer
          example: 1
        task_id:
          type: integer
          example: 123
        proj_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        title:
          type: string
          example: "Complete project documentation"
        description:
          type: string
          example: "Write comprehensive API documentation"
        start_date:
          type: string
          format: date-time
          example: "2025-01-15T09:00:00Z"
        end_date:
          type: string
          format: date-time
          example: "2025-01-15T17:00:00Z"
        status:
          type: string
          enum: [done, in_progress, due, upcoming]
          example: "in_progress"
        priority:
          type: string
          enum: [high, medium, low]
          example: "high"
        assigned_to:
          type: string
          format: uuid
          example: "660e8400-e29b-41d4-a716-446655440000"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TaskIssue:
      type: object
      properties:
        id:
          type: integer
          example: 1
        task_id:
          type: integer
          example: 123
        proj_id:
          type: string
          format: uuid
        issue_title:
          type: string
          example: "Bug in authentication"
        issue_description:
          type: string
          example: "Users cannot login with special characters"
        severity:
          type: string
          enum: [low, medium, high, critical]
          example: "high"
        status:
          type: string
          enum: [open, in_progress, resolved, closed]
          example: "open"
        reported_by:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Notification:
      type: object
      properties:
        id:
          type: integer
          example: 1
        uid:
          type: string
          format: uuid
          example: "660e8400-e29b-41d4-a716-446655440000"
        task_id:
          type: integer
          example: 123
        notification_type:
          type: string
          enum: [task_assigned, task_due_soon, task_overdue, issue_created, comment_added]
          example: "task_due_soon"
        message:
          type: string
          example: "Your task is due in 2 days"
        is_read:
          type: boolean
          example: false
        created_at:
          type: string
          format: date-time
          example: "2025-01-15T10:30:00Z"

  responses:
    BadRequest:
      description: Bad request - Missing or invalid parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            missingParam:
              value:
                success: false
                error: "Required parameter is missing"
                code: 400
            invalidParam:
              value:
                success: false
                error: "Invalid parameter value"
                code: 400

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            serverError:
              value:
                success: false
                error: "Internal server error"
                code: 500

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication (if implemented)
    
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Bearer token (if implemented)

# Uncomment to enable security globally
# security:
#   - ApiKeyAuth: []
#   - BearerAuth: []
